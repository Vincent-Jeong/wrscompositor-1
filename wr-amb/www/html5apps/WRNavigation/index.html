<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>GENIVI Navigation Simulator</title>
		<link href="navigation.css" rel="stylesheet">
		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript" src="gsimulator.js"></script>
		<script type="text/javascript" src="gsocket.js"></script>
		<script type="text/javascript" src="infobox.js"></script>
		<script src="http://code.jquery.com/jquery-1.4.1.min.js"></script>
		<script type="text/javascript" src="js/css-transform.js"></script>
		<script type="text/javascript" src="js/css-rotate.js"></script>
		<script>
			var simulator;

			function WRNaviInit() {
				console.log("WRNaviInit");
				//var start = new google.maps.LatLng(41.405159, 2.174373);
        		//var end = new google.maps.LatLng(41.375822, 2.177762);
				var start = new google.maps.LatLng(startlat, startlng);
        		var end = new google.maps.LatLng(destlat, destlng);
				simulator = new GSimulator();
				simulator.initialize();
				simulator.calcRoute(start, end);

				Number.prototype.toRad = function() { // convert degrees to radians
					return this * Math.PI / 180;
				}
				Number.prototype.toDeg = function() { // convert radians to degrees (signed)
					return this * 180 / Math.PI;
				}
				Number.prototype.toBrng = function() { // convert radians to degrees (as bearing: 0...360)
					return (this.toDeg()+360) % 360;
				}

				function latlon(lat1, lon1, lat2, lon2) {
					console.log("latlon");
					lat1 = lat1.toRad(); lat2 = lat2.toRad();
					console.log("lat1: " + lat1 + ", lat2: " + lat2);
					var dLon = (lon2-lon1).toRad();
					var y = Math.sin(dLon) * Math.cos(lat2);
					var x = Math.cos(lat1)*Math.sin(lat2) -
					Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);
					console.log("result: " + Math.atan2(y, x).toBrng());
					return Math.atan2(y, x).toBrng();
				}
				console.log(latlon(startlat, startlng, destlat, destlng));
			}
			function CalcRoute() {
				if (simulator) {
					console.log("calcRoute simulator");
					simulator.calcRoute();
				} else {
					console.log("not simulator");
				}
			}
		</script>
	</head>
	<body onload="WRNaviInit()">
<!--
		<div>
			<b>Start: </b>
			<select id="start">
				<option value="la sagrada familia">la sagrada familia</option>
			</select>
			<b>End: </b>
			<select id="end" onchange="CalcRoute();">
				<option value="Placa Catalunya">Placa Catalunya</option>
				<option value="Poble Espanyol">Poble Espanyol</option>
			</select>
		</div>
-->
	<div id="map-canvas"></div>
	<div id="speed-marker">0 Km/h</div>
	<div id="car-marker"><img id="car-img" src="car_marker.png" /></div>
	</body>
</html>

