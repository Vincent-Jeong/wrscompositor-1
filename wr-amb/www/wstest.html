<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<title>websocket test</title>
<script language="javascript" src="uuid.js"></script>
<script language="javascript" type="text/javascript">
    var output;
    var ws;

	function closeGW() {
		ws.close();
	}
	function connectGW() {
		log('wsUrl: '+wsUrl);
    	var wsUrl = "ws://"+window.location.hostname+":9090/";
        ws = new WebSocket(wsUrl, 'echo');
        ws.onopen = function(evt) { onOpen(evt) };
        ws.onclose = function(evt) { onClose(evt) };
        ws.onmessage = function(evt) { onMessage(evt) };
        ws.onerror = function(evt) { onError(evt) };
	}

    function init() {
        output = document.getElementById("debugout");
		connectGW();
    }

    function onOpen(evt) {
        log("WebSocket CONNECTED");
    }

    function onClose(evt) {
        log("WebSocket DISCONNECTED");
        //window.setTimeout(function() { window.location = window.location; }, 5000);
    }

    function onMessage(evt) {
		var obj = JSON.parse(evt.data);
		if(obj['name']=='Latitude')
			document.getElementById('latitude').innerHTML = obj['data'];
		else if(obj['name']=='Longitude')
			document.getElementById('longitude').innerHTML = obj['data'];
		else if(obj['name']=='VehicleSpeed')
			document.getElementById('speed').innerHTML = obj['data'];
		//log(evt.data);
    }

    function onError(evt) {
        log('<span style="color: red;">ERROR:</span> ' + evt.data);
    }

    function doSend(message) {
        log("SENT Command: " + message);
        ws.send(message);
    }

    function log(message) {
        var pre = document.createElement("div");
        pre.style.wordWrap = "break-word";
        pre.innerHTML = message;
        output.appendChild(pre);
        output.scrollTop = output.scrollHeight;
    }

    window.addEventListener("load", init, false);
	function getTime() {
		var dt = new Date();
		return dt.getTime()+dt.getMilliseconds()/1000;
	}

	function requestSpeed() {
		var obj = {"type":"valuechanged","name":"Latitude","data":"37.00100","transactionid": UUID.generate(), "timestamp":getTime(),"sequence":"0"};
		ws.send(JSON.stringify(obj));
	}
</script>
</head>
<body>
<button onclick="connectGW();">connect socket</button>
<button onclick="closeGW();">disconnect socket</button>
<button onclick="requestSpeed();">req speed()</button>
<p>
Latitude: <span id="latitude"></span>
</p>
<p>
Longitude: <span id="longitude"></span>
</p>
<p>
Speed: <span id="speed"></span> Km/h
</p>
<div id="debugout"></div>
</body>
</html>
